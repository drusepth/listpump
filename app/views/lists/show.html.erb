<ul class="nav nav-tabs" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#home" role="tab">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#triggers" role="tab">
      Triggers
      <span class="badge badge-default <%= @triggers.any? ? 'badge-success' : 'badge-danger' %>"><%= @triggers.count %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#people" role="tab">
      People
      <span class="badge badge-default <%= @people.any? ? 'badge-success' : 'badge-danger' %>"><%= @people.count %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#settings" role="tab">Settings</a>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="home" role="tabpanel">
    <h1>
      <%= @list.name %>
    </h1>
  </div>
  <div class="tab-pane" id="people" role="tabpanel">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Medium</th>
          <th>Triggered phrases</th>
          <th>Other lists</th>
          <th colspan="2"></th>
        </tr>
      </thead>

      <tbody>
        <% @people.order(:name).each do |person| %>
          <tr>
            <td><%= link_to person.name, person %></td>
            <td><%= person.medium %></td>
            <td>
              <ul>
                <% person.list_inclusions.each do |list_inclusion| %>
                  <% next unless list_inclusion.list == @list %>
                  <li>
                    "<%= list_inclusion.matched_text %>" (<%= link_to list_inclusion.trigger.name, list_inclusion.trigger %>)
                  </li>
                <% end %>
              </ul>
            </td>
            <td>
              <ul>
                <% person.lists.reject { |list| list == @list }.uniq.each do |list| %>
                  <li><%= link_to list.name, list %></li>
                <% end %>
              </ul>
            </td>
            <td><%# link_to 'Edit', edit_person_path(person) %></td>
            <td><%# link_to 'Destroy', person, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="tab-pane" id="triggers" role="tabpanel">
    <h1>
      Triggers
      <%= link_to 'Add', new_trigger_path(list_id: @list.id), class: "btn #{'btn-primary' if @triggers.empty?}" %>
    </h1>

    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Search Query</th>
          <th>Match Pattern</th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
        <% @triggers.order(:name).each do |trigger| %>
          <tr>
            <td><%= trigger.name %></td>
            <td><%= trigger.search_query %></td>
            <td>/<%= trigger.pattern %>/</td>
            <td><%= link_to 'Edit', edit_trigger_path(trigger) %></td>
            <td><%= link_to 'Destroy', trigger, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="tab-pane" id="settings" role="tabpanel">
    <%= render partial: 'lists/form', locals: { list: @list } %>
    <%= link_to 'Delete', @list, method: :delete, data: { confirm: 'Are you sure?' } %>
  </div>
</div>
